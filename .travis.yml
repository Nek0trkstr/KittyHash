language: node_js
node_js:
  - 11
  - 12

after_success:
  - cd ui
  - npm i -g codecov
  - codecov

jobs:
  include:
    - stage: Install
      script: 
        - cd ui
        - npm ci
    - stage: Lint
      script: 
        - npm run-script lint
    - stage: Build
      script:
        - npm run-script build
    - stage: Test
      script:
        - npm test -- --coverage --watchAll=false
        - npm i -g codecov
        - codecov
    - stage: Test Docker
      services:
        - docker
      script:
        - docker build .
    - stage: Deploy
      script:
        - echo 'deploy me'

stages:
  - name: Test
    # require the type to be a PR
    if: type = pull_request
  - name: Deploy
    # require the type to be push to master
    if: type = push AND branch = master